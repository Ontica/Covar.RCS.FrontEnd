<div class="task-list-container" *ngIf="filter.project !== ''">

  <div class="task-list-header">
    <button class="btn-warning" (click)="showInitialActivityInlineEditor()">Nueva</button>
    <span *ngIf="filter.project.name">Proyecto: {{filter.project.name}}</span>
  </div>

  <div class="task-list">

    <div *ngIf="(addFirstActivityEditorVisible && !hasSelectedActivities)" class="add-task">
      <div>
        <label>Tarea inicial:</label>
        <input #txtActivityName type="text"
               class="text-box" style="width:80%"
               (keyup.esc)="hideInlineEditors()"
               (keyup.enter)="insertActivity(txtActivityName.value)">
        <button class="btn" (click)="hideInlineEditors()">Cancelar</button>
      </div>
    </div>

    <!-- Drop area for the first position -->
    <div class="activity-drop-by-position-area"
        draggable="dragging"
        (dragover)="allowDrop($event)"
        (drop)="moveActivity($event, 0)">
    </div>

    <div class="task-row" *ngFor="let activity of activityTree">

      <div [class.selected-row]="isActivitySelected(activity)"
            draggable="dragging"
            (dragover)="allowDrop($event)"
            (dragstart)="drag($event, activity)"
            (drop)="moveActivity($event, activity.position)">

          <div class="row-options">
            <i class="fa fa-arrows drag-icon" aria-hidden="true" (mousedown)="startDrag()"></i>
          </div>

          <div class="task"
            draggable="dragging"
            (dragover)="allowDrop($event)"
            (dragstart)="drag($event, activity)"
            (drop)="moveActivityAsChildOf($event, activity)">

            <a [ngClass]="activityNameClass(activity.level)"
               [style.padding-left.pt]="activity.level * 10"
               (click)="selectActivity(activity, true)">{{activity.name}}</a>

          </div>

          <div class="task-options">

            <a (click)="toggleAddChildEditor(activity)">
              <i [ngClass]="addChildEditorVisible && isActivitySelected(activity) ? 'fa fa-minus-circle' : 'fa fa-plus-circle'"
                           aria-hidden="true"></i>
            </a>

            <span class="delete-icon-container">
              <a (click)="deleteTask(activity.uid)">
                <i class="fa fa-trash delete-icon"></i>
              </a>
            </span>

          </div>

      </div>

      <div class="activity-drop-by-position-area"
            draggable="dragging"
            (dragover)="allowDrop($event)"
            (drop)="moveActivity($event, activity.position)">
      </div>

      <div *ngIf="isActivitySelected(activity)" class="add-task-editor">

        <div *ngIf="addChildEditorVisible">
          <label>Tarea hija:</label>
          <input #txtActivityName type="text"
                 class="text-box" style="width:80%"
                 (keyup.esc)="hideInlineEditors()"
                 (keyup.enter)="createChildActivity(txtActivityName.value, activity)">
          <button class="btn" (click)="hideInlineEditors()">Cancelar</button>
        </div>

        <div *ngIf="insertActivityEditorVisible">
          <label>Nueva tarea:</label>
          <input #txtActivityName type="text"
                 class="text-box" style="width:70%"
                 (keyup.esc)="hideInlineEditors()"
                 (keyup.enter)="insertActivity(txtActivityName.value, activity.position)">
          <button class="btn" (click)="hideInlineEditors()">Cancelar</button>
        </div>

      </div>

    </div>

  </div>

</div>
